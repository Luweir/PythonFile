import numpy as np
import pandas as pd
from fastdtw import fastdtw
import math

EARTH_RADIUS = 6371229  # m 用于两点间距离计算


def get_haversine(point_a, point_b):
    lat1 = point_a[0] * math.pi / 180
    lat2 = point_b[0] * math.pi / 180
    lon1 = point_a[1] * math.pi / 180
    lon2 = point_b[1] * math.pi / 180
    d_lat = lat2 - lat1
    d_lon = lon2 - lon1
    a_a = math.sin(d_lat / 2) ** 2 + math.cos(lat1) * math.cos(lat2) * math.sin(d_lon / 2) ** 2
    c = 2 * math.atan2(math.sqrt(a_a), math.sqrt(1 - a_a))
    return EARTH_RADIUS * c


def euc_dist(p1, p2):
    return math.sqrt((p1[0] - p2[0]) ** 2 + (p1[1] - p2[1]) ** 2)


def get_distance(p1, p2):
    return abs(p1[1] - p2[1])


def get_fastdtw(traj1, traj2):
    distance, path = fastdtw(traj1, traj2, dist=euc_dist)
    return distance
    # print("" + str(distance / 1000000))  # km


if __name__ == '__main__':
    traj1 = [[1353941705000000, 53.299281999999998],
             [1353941724000000, 53.299281999999998],
             [1353941744000000, 53.299281999999998],
             [1353941763000000, 53.299281999999998],
             [1353941783000000, 53.299281999999998],
             [1353941804000000, 53.299281999999998],
             [1353941822000000, 53.299281999999998],
             [1353941843000000, 53.299281999999998],
             [1353941865000000, 53.299281999999998],
             [1353941882000000, 53.299281999999998],
             [1353941904000000, 53.299149000000000],
             [1353941923000000, 53.297637999999999],
             [1353941943000000, 53.297192000000003],
             [1353941964000000, 53.295684999999999],
             [1353941982000000, 53.295295999999993],
             [1353942004000000, 53.296145999999993],
             [1353942024000000, 53.298072999999995],
             [1353942044000000, 53.299422999999997],
             [1353942063000000, 53.300506999999996],
             [1353942083000000, 53.301651000000000],
             [1353942104000000, 53.303566000000004],
             [1353942122000000, 53.304504000000001],
             [1353942145000000, 53.306170999999999],
             [1353942163000000, 53.307120999999995],
             [1353942184000000, 53.307941000000007],
             [1353942204000000, 53.309376000000000],
             [1353942224000000, 53.309803000000002],
             [1353942243000000, 53.311089000000003]]
    traj2 = [[1353924161000000, 53.352814000000002],
             [1353924184000000, 53.352814000000002],
             [1353924202000000, 53.352814000000002],
             [1353924242000000, 53.352814000000002]]
    get_fastdtw(np.array(traj1), np.array(traj2))
